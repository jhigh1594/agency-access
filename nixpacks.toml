# Nixpacks configuration for Railway
# This ensures a clean build process

[phases.setup]
nixPkgs = ['nodejs-20_x', 'npm']

[phases.install]
cmds = ['npm install']

[phases.build]
cmds = [
  'npm run build --workspace=packages/shared',
  'cd apps/api && rm -rf dist node_modules/.cache && npm run db:generate && npm run build',
  'cd apps/api && echo "Verifying build:" && head -3 dist/routes/oauth-test.js'
]

[start]
cmd = "cd apps/api && npm start"

